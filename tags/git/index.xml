<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>git on ESG's</title><link>https://esg.dev/tags/git/</link><description>Recent content in git on ESG's</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Mon, 21 Sep 2020 14:01:55 -0400</lastBuildDate><atom:link href="https://esg.dev/tags/git/index.xml" rel="self" type="application/rss+xml"/><item><title>Stupid Git tricks: Merging and splitting repositories</title><link>https://esg.dev/posts/git-merge-split/</link><pubDate>Mon, 21 Sep 2020 14:01:55 -0400</pubDate><guid>https://esg.dev/posts/git-merge-split/</guid><description>&lt;p>Maybe it&amp;rsquo;s due to working mainly in small shops, but I&amp;rsquo;ve had to merge and split git repositories a number of times in the past few years (usually related to folks pushing for microservice architecture, and then changing their minds).&lt;/p>
&lt;p>Fortunately, git allows us to do both operations without losing the history.&lt;/p>
&lt;p>Needless to say, those operations should not be part of your daily flow, but it&amp;rsquo;s good to have in your toolbox if you ever find yourself in a situation that requires it.&lt;/p>
&lt;h1 id="warning">Warning&lt;/h1>
&lt;p>Some of the operations described here, especially when it comes to splitting, are extremely destructive as they can rewrite your git history. As a result, other contributors may not be able to push or send pull requests anymore.&lt;/p>
&lt;p>Ideally, these operations should be done on fresh clones, and pushed to new remotes.&lt;/p>
&lt;h1 id="merging">Merging&lt;/h1>
&lt;p>Let&amp;rsquo;s say you have 2 local repositories that you want to merge, called &lt;code>A&lt;/code> and &lt;code>B&lt;/code>, and you want to copy the history of &lt;code>A&lt;/code> into &lt;code>B&lt;/code>.&lt;/p>
&lt;h2 id="step-1-organization">Step 1: Organization&lt;/h2>
&lt;p>In order to save yourself some headaches, it&amp;rsquo;s better to plan ahead how you want the final repository layout to be. You&amp;rsquo;ll also want to move files around to avoid any conflicts.&lt;/p>
&lt;p>For simplicity, I want the end result to be:&lt;/p>
&lt;pre>&lt;code>src/A
src/B
&lt;/code>&lt;/pre>&lt;p>In the &lt;code>A&lt;/code> repository, using whatever tools you want, create the &lt;code>src/A&lt;/code> directory and move everything in there.&lt;/p>
&lt;p>After that, execute &lt;code>git add -A&lt;/code> to update the index and make sure you &lt;code>git commit&lt;/code>.&lt;/p>
&lt;p>Repeat the process for repository &lt;code>B&lt;/code>.&lt;/p>
&lt;p>And now everything should be where you want it to be.&lt;/p>
&lt;h2 id="step-2-pull">Step 2: Pull&lt;/h2>
&lt;p>From the &lt;code>B&lt;/code> repository, you will need to &lt;code>git pull&lt;/code> with the &lt;code>allow-unrelated-histories&lt;/code> to, surprise, allow the unrelated histories of both repositories to be merged together.&lt;/p>
&lt;p>If both repositories are within the same directory, you&amp;rsquo;d can use this: &lt;code>git pull --allow-unrelated-histories ../A&lt;/code>.&lt;/p>
&lt;p>Once that&amp;rsquo;s done, check the content of your repository and your &lt;code>git log&lt;/code> to make sure that everything is good, and then you are done!&lt;/p>
&lt;h1 id="splitting">Splitting&lt;/h1>
&lt;p>In this scenario, we&amp;rsquo;ll be reverting the changes we&amp;rsquo;ve done above, going from 1 repository containing:&lt;/p>
&lt;pre>&lt;code>src/A
src/B
&lt;/code>&lt;/pre>&lt;p>and split them back into 2 repositories, with the content at the root of each ones.&lt;/p>
&lt;h2 id="danger-will-robinson">Danger Will Robinson&lt;/h2>
&lt;p>Splitting a repository is a highly destructive operation. Not only is it possible to lose the content of your repository, in fact, that&amp;rsquo;s basically how the tool works. It &lt;em>rewrites the history&lt;/em> and wipes out any traces of the items you have taken out.&lt;/p>
&lt;p>Even when things go well, and you can stitch the repositories back into one using the steps above, commits that used to contain changes that were formerly in the same repository will stay separate. That data is gone forever.&lt;/p>
&lt;h2 id="prerequisite">Prerequisite&lt;/h2>
&lt;p>For this operation, we&amp;rsquo;ll be using a 3rd party tool called &lt;a href="https://github.com/newren/git-filter-repo/">git filter-repo&lt;/a>. Note that this tool is a recommendation from the &lt;a href="https://git-scm.com/docs/git-filter-branch">git filter-branch&lt;/a> man pages.&lt;/p>
&lt;p>&lt;a href="https://github.com/newren/git-filter-repo/blob/main/INSTALL.md">Install&lt;/a> it for your environment and we&amp;rsquo;ll be good to go.&lt;/p>
&lt;h2 id="cloning">Cloning&lt;/h2>
&lt;p>To makes things easier, do 2 fresh clones of your repository. Each clones will be rewritten with only the content we want.&lt;/p>
&lt;h2 id="using-git-filter-repo">Using git filter-repo&lt;/h2>
&lt;p>Open your command prompt/shell/terminal into the root of your first clone.&lt;/p>
&lt;p>Now type &lt;code>git filter-repo --subdirectory-filter src/A&lt;/code>&lt;/p>
&lt;p>This will remove everything that is NOT under &lt;code>src/A&lt;/code> and move the content to the root of the repository.&lt;/p>
&lt;p>Repeat the same operation for your second clone, changing &lt;code>src/A&lt;/code> to &lt;code>src/B&lt;/code>, and you are done!&lt;/p>
&lt;h1 id="conclusion">Conclusion&lt;/h1>
&lt;p>These are some of the ways I&amp;rsquo;ve used in the past to split and merge git repositories. What are yours? Hit me up on &lt;a href="https://twitter.com/Eric_STG">twitter&lt;/a>!&lt;/p></description><category>git</category></item></channel></rss>